rule mosdepth:
    input:
        bam="aligned/{dataset}.bam",
        bai="aligned/{dataset}.bam.bai",
    output:
        "mosdepth/{dataset}.mosdepth.global.dist.txt",
        "mosdepth/{dataset}.per-base.bed.gz",
        summary="mosdepth/{dataset}.mosdepth.summary.txt",
    log:
        "logs/mosdepth/{dataset}.log",
    params:
        extra="--fast-mode",
    threads: 4
    wrapper:
        "master/bio/mosdepth"


rule mosdepth_bed:
    input:
        bam="aligned/{dataset}.bam",
        bai="aligned/{dataset}.bam.bai",
        bed="test.bed",
    output:
        "mosdepth_bed/{dataset}.mosdepth.global.dist.txt",
        "mosdepth_bed/{dataset}.mosdepth.region.dist.txt",
        "mosdepth_bed/{dataset}.regions.bed.gz",
        summary="mosdepth_bed/{dataset}.mosdepth.summary.txt",
    log:
        "logs/mosdepth_bed/{dataset}.log",
    params:
        extra="--use-median",
    threads: 4
    wrapper:
        "master/bio/mosdepth"


rule mosdepth_by_threshold:
    input:
        bam="aligned/{dataset}.bam",
        bai="aligned/{dataset}.bam.bai",
    output:
        "mosdepth_by_threshold/{dataset}.mosdepth.global.dist.txt",
        "mosdepth_by_threshold/{dataset}.mosdepth.region.dist.txt",
        "mosdepth_by_threshold/{dataset}.regions.bed.gz",
        "mosdepth_by_threshold/{dataset}.thresholds.bed.gz",
        summary="mosdepth_by_threshold/{dataset}.mosdepth.summary.txt",
    log:
        "logs/mosdepth_by/{dataset}.log",
    params:
        by="500",  # needed for mosdepth.region.dist.txt and regions.bed.gz
        thresholds="1,5,10,30",  # needed for thresholds.bed.gz
    threads: 4
    wrapper:
        "master/bio/mosdepth"


rule mosdepth_quantize_precision:
    input:
        bam="aligned/{dataset}.bam",
        bai="aligned/{dataset}.bam.bai",
    output:
        "mosdepth_quantize_precision/{dataset}.mosdepth.global.dist.txt",
        "mosdepth_quantize_precision/{dataset}.quantized.bed.gz",
        summary="mosdepth_quantize_precision/{dataset}.mosdepth.summary.txt",
    log:
        "logs/mosdepth_quantize_precision/{dataset}.log",
    params:
        quantize="0:1:5:150",  # needed for quantized.bed.gz
        precision="5",  # optional, set decimals of precision
    threads: 4
    wrapper:
        "master/bio/mosdepth"


rule mosdepth_cram:
    input:
        bam="aligned/{dataset}.cram",
        bai="aligned/{dataset}.cram.crai",
        bed="test.bed",
        fasta="genome.fasta",
    output:
        "mosdepth_cram/{dataset}.mosdepth.global.dist.txt",
        "mosdepth_cram/{dataset}.mosdepth.region.dist.txt",
        "mosdepth_cram/{dataset}.regions.bed.gz",
        summary="mosdepth_cram/{dataset}.mosdepth.summary.txt",
    log:
        "logs/mosdepth_cram/{dataset}.log",
    params:
        extra="--use-median",
    threads: 4
    wrapper:
        "master/bio/mosdepth"
